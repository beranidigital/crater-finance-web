import{D as Z,C as ee,u as te,ao as ae,f as oe,e as le,g as v,F as se,l as w,h,i as M,j as ne,k as re,r as u,o as c,n as k,w as n,b as m,q as b,t as y,a as l,c as C,m as t,I as V,H as ie}from"./main-55335c70.js";import{u as de}from"./mail-sender-1c84da3c.js";import{_ as ue}from"./FeedbackAlert-4879c716.js";const ce={class:"flex justify-between w-full"},me={key:0,action:""},pe={key:0,class:"px-8 py-8 sm:p-6"},ve={key:1},_e={class:"mt-4"},fe={class:"-mx-2 -my-1.5 flex"},be={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},ye={key:1},ge={class:"my-6 mx-4 border border-gray-200 relative"},$e=["src"],we={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},Me={__name:"SendInvoiceModal",emits:["update"],setup(he,{emit:F}){const p=Z(),P=ee(),G=te(),x=ae(),R=de(),z=oe(),{t:_}=le();let i=v(!1);const j=v(""),g=v(!1),I=v(null),B=v(!1);v(null);const E=F,L=v(["customer","customerCustom","invoice","invoiceCustom","company"]),s=se({id:null,mail_sender_id:null,to:null,subject:"New Invoice",body:null}),T=w(()=>p.active&&p.componentName==="SendInvoiceModal"),A=w(()=>p.title),N=w(()=>p.data),O={mail_sender_id:{required:h.withMessage(_("validation.required"),M)},to:{required:h.withMessage(_("validation.required"),M),email:h.withMessage(_("validation.email_incorrect"),ne)},subject:{required:h.withMessage(_("validation.required"),M)},body:{required:h.withMessage(_("validation.required"),M)}},o=re(O,w(()=>s));function H(){g.value=!1}async function X(){s.id=p.id,N.value&&(s.to=N.value.customer.email),s.body=P.selectedCompanySettings.invoice_mail_body,B.value=!0;let a=await R.fetchMailSenders({limit:"all"});if(a.data){I.value=a.data.data;let e=a.data.data.find(d=>d.is_default==!0);s.mail_sender_id=e?e.id:null,B.value=!1}}async function U(){if(o.value.$touch(),o.value.$invalid)return!0;try{if(i.value=!0,!g.value){const d=await x.previewInvoice(s);i.value=!1,g.value=!0;var a=new Blob([d.data],{type:"text/html"});j.value=URL.createObjectURL(a);return}const e=await x.sendInvoice(s);if(i.value=!1,e.data.success)return E("update",p.id),f(),!0}catch(e){console.error(e),i.value=!1,G.showNotification({type:"error",message:_("invoices.something_went_wrong")})}}function f(){p.closeModal(),setTimeout(()=>{o.value.$reset(),g.value=!1,j.value=null},300)}const q=w(()=>I.value&&I.value.length);function J(){f(),z.push("/admin/settings/mail-sender")}return(a,e)=>{const d=u("BaseIcon"),K=u("BaseMultiselect"),S=u("BaseInputGroup"),D=u("BaseInput"),Q=u("BaseCustomInput"),W=u("BaseInputGrid"),$=u("BaseButton"),Y=u("BaseModal");return c(),k(Y,{show:T.value,onClose:f,onOpen:X},{header:n(()=>[m("div",ce,[b(y(A.value)+" ",1),l(d,{name:"XIcon",class:"w-6 h-6 text-gray-500 cursor-pointer",onClick:f})])]),default:n(()=>[g.value?(c(),C("div",ye,[m("div",ge,[l($,{class:"absolute top-4 right-4",disabled:t(i),variant:"primary-outline",onClick:H},{default:n(()=>[l(d,{name:"PencilIcon",class:"h-5 mr-2"}),b(" Edit ")]),_:1},8,["disabled"]),m("iframe",{src:j.value,frameborder:"0",class:"w-full",style:{"min-height":"500px"}},null,8,$e)]),m("div",we,[l($,{class:"mr-3",variant:"primary-outline",type:"button",onClick:f},{default:n(()=>[b(y(a.$t("general.cancel")),1)]),_:1}),l($,{loading:t(i),disabled:t(i),variant:"primary",type:"button",onClick:e[6]||(e[6]=r=>U())},{default:n(()=>[t(i)?V("",!0):(c(),k(d,{key:0,name:"PaperAirplaneIcon",class:"h-5 mr-2"})),b(" "+y(a.$t("general.send")),1)]),_:1},8,["loading","disabled"])])])):(c(),C("form",me,[q.value?(c(),C("div",pe,[l(W,{layout:"one-column",class:"col-span-7"},{default:n(()=>[l(S,{label:a.$tc("settings.mail_sender.title",1),required:"",error:t(o).mail_sender_id.$error&&t(o).mail_sender_id.$errors[0].$message},{default:n(()=>[l(K,{modelValue:s.mail_sender_id,"onUpdate:modelValue":e[0]||(e[0]=r=>s.mail_sender_id=r),invalid:t(o).mail_sender_id.$error,label:"name",options:I.value,"value-prop":"id","can-deselect":!1,"can-clear":!1,placeholder:a.$t("settings.mail_sender.select_mail_sender"),searchable:"","track-by":"name","content-loading":B.value},null,8,["modelValue","invalid","options","placeholder","content-loading"])]),_:1},8,["label","error"]),l(S,{label:a.$t("general.to"),required:"",error:t(o).to.$error&&t(o).to.$errors[0].$message},{default:n(()=>[l(D,{modelValue:s.to,"onUpdate:modelValue":e[1]||(e[1]=r=>s.to=r),type:"text",invalid:t(o).to.$error,onInput:e[2]||(e[2]=r=>t(o).to.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),l(S,{error:t(o).subject.$error&&t(o).subject.$errors[0].$message,label:a.$t("general.subject"),required:""},{default:n(()=>[l(D,{modelValue:s.subject,"onUpdate:modelValue":e[3]||(e[3]=r=>s.subject=r),type:"text",invalid:t(o).subject.$error,onInput:e[4]||(e[4]=r=>t(o).subject.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["error","label"]),l(S,{label:a.$t("general.body"),error:t(o).body.$error&&t(o).body.$errors[0].$message,required:""},{default:n(()=>[l(Q,{modelValue:s.body,"onUpdate:modelValue":e[5]||(e[5]=r=>s.body=r),fields:L.value},null,8,["modelValue","fields"])]),_:1},8,["label","error"])]),_:1})])):!q.value&&!B.value?(c(),C("div",ve,[l(ue,{title:a.$t("settings.mail_sender.no_mail_sender_found"),description:a.$t("settings.mail_sender.no_mail_sender_found_description"),type:"warning"},{action:n(()=>[m("div",_e,[m("div",fe,[m("button",{type:"button",class:"bg-yellow-50 px-2 py-1.5 rounded-md text-sm font-medium text-yellow-800 hover:bg-yellow-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-yellow-50 focus:ring-yellow-600",onClick:J},y(a.$t("settings.mail_sender.manage_mail_sender")),1)])])]),_:1},8,["title","description"])])):V("",!0),m("div",be,[l($,{class:"mr-3",variant:"primary-outline",type:"button",onClick:f},{default:n(()=>[b(y(a.$t("general.cancel")),1)]),_:1}),q.value?(c(),k($,{key:0,loading:t(i),disabled:t(i),variant:"primary",type:"button",class:"mr-3",onClick:U},{left:n(r=>[t(i)?V("",!0):(c(),k(d,{key:0,class:ie(r.class),name:"PhotographIcon"},null,8,["class"]))]),default:n(()=>[b(" "+y(a.$t("general.preview")),1)]),_:1},8,["loading","disabled"])):V("",!0)])]))]),_:1},8,["show"])}}};export{Me as _};
