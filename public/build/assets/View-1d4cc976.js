import{a6 as M,J as N,e as Y,g as F,F as R,N as ee,l as k,r as i,o as l,c as $,b as r,a as e,w as n,m as a,t as B,n as m,L as X,M as q,I as p,H as G,q as V,X as te,C as se,a3 as J,A as ae,p as ne,a5 as le,K as oe,f as re,O as S}from"./main-55335c70.js";import{L as ce}from"./LoadingIcon-fa016bf5.js";import{_ as ie}from"./LineChart-166678da.js";import{_ as ue}from"./CustomerIndexDropdown-86ac261b.js";const de={class:"fixed top-0 left-0 hidden h-full pt-16 pb-[6.6rem] ml-56 bg-white xl:ml-64 w-88 xl:block"},me={class:"flex items-center justify-between px-4 pt-8 pb-2 border border-gray-200 border-solid height-full"},_e={class:"flex mb-6 ml-3",role:"group","aria-label":"First group"},pe={class:"px-4 py-3 pb-2 mb-2 text-sm border-b border-gray-200 border-solid"},fe={class:"px-2"},he={class:"px-2"},ye={class:"flex-1 font-bold text-right whitespace-nowrap"},ge={key:0,class:"flex justify-center p-4 items-center"},ve={key:1,class:"flex justify-center px-4 mt-5 text-sm text-gray-600"},xe={__name:"CustomerViewSidebar",setup(L){const T=M(),t=N(),{t:u}=Y();let c=F(!1),s=R({orderBy:null,orderByField:null,searchText:null});const _=F(null),y=F(1),g=F(1),I=F(null);x=ee.debounce(x,500);const f=k(()=>s.orderBy==="asc"||s.orderBy==null);k(()=>f.value?u("general.ascending"):u("general.descending"));function w(o){return t.params.id==o}async function v(o,h=!1){if(c.value)return;let E={};s.searchText!==""&&s.searchText!==null&&s.searchText!==void 0&&(E.display_name=s.searchText),s.orderBy!==null&&s.orderBy!==void 0&&(E.orderBy=s.orderBy),s.orderByField!==null&&s.orderByField!==void 0&&(E.orderByField=s.orderByField),c.value=!0;let A=await T.fetchCustomers({page:o,...E,limit:15});c.value=!1,_.value=_.value?_.value:[],_.value=[..._.value,...A.data.data],y.value=o||1,g.value=A.data.meta.last_page;let P=_.value.find(j=>j.id==t.params.id);h==!1&&!P&&y.value<g.value&&Object.keys(E).length===0&&v(++y.value),P&&setTimeout(()=>{h==!1&&C()},500)}function C(){const o=document.getElementById(`customer-${t.params.id}`);o&&(o.scrollIntoView({behavior:"smooth"}),o.classList.add("shake"),D())}function D(){I.value.addEventListener("scroll",o=>{o.target.scrollTop>0&&o.target.scrollTop+o.target.clientHeight>o.target.scrollHeight-200&&y.value<g.value&&v(++y.value,!0)})}async function x(){_.value=[],v()}function d(){return s.orderBy==="asc"?(s.orderBy="desc",x(),!0):(s.orderBy="asc",x(),!0)}return v(),(o,h)=>{var z;const E=i("BaseIcon"),A=i("BaseInput"),P=i("BaseButton"),j=i("BaseRadio"),O=i("BaseInputGroup"),U=i("BaseDropdownItem"),K=i("BaseDropdown"),H=i("BaseText"),Q=i("BaseFormatMoney"),W=i("router-link");return l(),$("div",de,[r("div",me,[e(A,{modelValue:a(s).searchText,"onUpdate:modelValue":h[0]||(h[0]=b=>a(s).searchText=b),placeholder:o.$t("general.search"),"container-class":"mb-6",type:"text",variant:"gray",onInput:h[1]||(h[1]=b=>x())},{default:n(()=>[e(E,{name:"SearchIcon",class:"text-gray-500"})]),_:1},8,["modelValue","placeholder"]),r("div",_e,[e(K,{"close-on-select":!1,position:"bottom-start","width-class":"w-40","position-class":"left-0"},{activator:n(()=>[e(P,{variant:"gray"},{default:n(()=>[e(E,{name:"FilterIcon"})]),_:1})]),default:n(()=>[r("div",pe,B(o.$t("general.sort_by")),1),r("div",fe,[e(U,{class:"flex px-1 py-2 mt-1 cursor-pointer hover:rounded-md"},{default:n(()=>[e(O,{class:"pt-2 -mt-4"},{default:n(()=>[e(j,{id:"filter_create_date",modelValue:a(s).orderByField,"onUpdate:modelValue":[h[2]||(h[2]=b=>a(s).orderByField=b),x],label:o.$t("customers.create_date"),size:"sm",name:"filter",value:"invoices.created_at"},null,8,["modelValue","label"])]),_:1})]),_:1})]),r("div",he,[e(U,{class:"flex px-1 cursor-pointer hover:rounded-md"},{default:n(()=>[e(O,{class:"pt-2 -mt-4"},{default:n(()=>[e(j,{id:"filter_display_name",modelValue:a(s).orderByField,"onUpdate:modelValue":[h[3]||(h[3]=b=>a(s).orderByField=b),x],label:o.$t("customers.display_name"),size:"sm",name:"filter",value:"name"},null,8,["modelValue","label"])]),_:1})]),_:1})])]),_:1}),e(P,{class:"ml-1",size:"md",variant:"gray",onClick:d},{default:n(()=>[f.value?(l(),m(E,{key:0,name:"SortAscendingIcon"})):(l(),m(E,{key:1,name:"SortDescendingIcon"}))]),_:1})])]),r("div",{ref_key:"customerListSection",ref:I,class:"h-full overflow-y-scroll border-l border-gray-200 border-solid sidebar base-scroll"},[(l(!0),$(X,null,q(_.value,(b,Z)=>(l(),$("div",{key:Z},[b?(l(),m(W,{key:0,id:"customer-"+b.id,to:`/admin/customers/${b.id}/view`,class:G(["flex justify-between p-4 items-center cursor-pointer hover:bg-gray-100 border-l-4 border-transparent",{"bg-gray-100 border-l-4 border-primary-500 border-solid":w(b.id)}]),style:{"border-top":"1px solid rgba(185, 193, 209, 0.41)"}},{default:n(()=>[r("div",null,[e(H,{text:b.name,length:30,class:"pr-2 text-sm not-italic font-normal leading-5 text-black capitalize truncate"},null,8,["text"]),b.contact_name?(l(),m(H,{key:0,text:b.contact_name,length:30,class:"mt-1 text-xs not-italic font-medium leading-5 text-gray-600"},null,8,["text"])):p("",!0)]),r("div",ye,[e(Q,{amount:b.due_amount!==null?b.due_amount:0,currency:b.currency},null,8,["amount","currency"])])]),_:2},1032,["id","to","class"])):p("",!0)]))),128)),a(c)?(l(),$("div",ge,[e(ce,{class:"h-6 m-1 animate-spin text-primary-400"})])):p("",!0),!((z=_.value)!=null&&z.length)&&!a(c)?(l(),$("p",ve,B(o.$t("customers.no_matching_customers")),1)):p("",!0)],512)])}}},be={class:"pt-6 mt-5 border-t border-solid lg:pt-8 md:pt-4 border-gray-200"},Be={key:0,class:"text-sm font-bold leading-5 text-black non-italic"},$e={key:0},we={key:1},Ce={key:1,class:"text-sm font-bold leading-5 text-black non-italic"},Te={__name:"CustomerInfo",setup(L){const T=M(),t=k(()=>T.selectedViewCustomer),u=k(()=>T.isFetchingViewData),c=k(()=>{var s,_;return(s=t==null?void 0:t.value)!=null&&s.fields?(_=t==null?void 0:t.value)==null?void 0:_.fields:[]});return(s,_)=>{const y=i("BaseHeading"),g=i("BaseDescriptionListItem"),I=i("BaseDescriptionList"),f=i("BaseCustomerAddressDisplay");return l(),$("div",be,[e(y,null,{default:n(()=>[V(B(s.$t("customers.basic_info")),1)]),_:1}),e(I,null,{default:n(()=>{var w,v,C;return[e(g,{"content-loading":u.value,label:s.$t("customers.display_name"),value:(w=t.value)==null?void 0:w.name},null,8,["content-loading","label","value"]),e(g,{"content-loading":u.value,label:s.$t("customers.primary_contact_name"),value:(v=t.value)==null?void 0:v.contact_name},null,8,["content-loading","label","value"]),e(g,{"content-loading":u.value,label:s.$t("customers.email"),value:(C=t.value)==null?void 0:C.email},null,8,["content-loading","label","value"])]}),_:1}),e(I,{class:"mt-5"},{default:n(()=>{var w,v,C,D,x,d,o;return[e(g,{"content-loading":u.value,label:s.$t("wizard.currency"),value:(w=t.value)!=null&&w.currency?`${(C=(v=t.value)==null?void 0:v.currency)==null?void 0:C.code} (${(x=(D=t.value)==null?void 0:D.currency)==null?void 0:x.symbol})`:""},null,8,["content-loading","label","value"]),e(g,{"content-loading":u.value,label:s.$t("customers.phone_number"),value:(d=t.value)==null?void 0:d.phone},null,8,["content-loading","label","value"]),e(g,{"content-loading":u.value,label:s.$t("customers.website"),value:(o=t.value)==null?void 0:o.website},null,8,["content-loading","label","value"])]}),_:1}),t.value.billing||t.value.shipping?(l(),m(y,{key:0,class:"mt-8"},{default:n(()=>[V(B(s.$t("customers.address")),1)]),_:1})):p("",!0),e(I,{class:"mt-5"},{default:n(()=>[t.value.billing?(l(),m(g,{key:0,"content-loading":u.value,label:s.$t("customers.billing_address")},{default:n(()=>[e(f,{address:t.value.billing},null,8,["address"])]),_:1},8,["content-loading","label"])):p("",!0),t.value.shipping?(l(),m(g,{key:1,"content-loading":u.value,label:s.$t("customers.shipping_address")},{default:n(()=>[e(f,{address:t.value.shipping},null,8,["address"])]),_:1},8,["content-loading","label"])):p("",!0)]),_:1}),c.value.length>0?(l(),m(y,{key:1,class:"mt-8"},{default:n(()=>[V(B(s.$t("settings.custom_fields.title")),1)]),_:1})):p("",!0),e(I,{class:"mt-5"},{default:n(()=>[(l(!0),$(X,null,q(c.value,(w,v)=>(l(),m(g,{key:v,"content-loading":u.value,label:w.custom_field.label},{default:n(()=>[w.type==="Switch"?(l(),$("p",Be,[w.default_answer===1?(l(),$("span",$e," Yes ")):(l(),$("span",we," No "))])):(l(),$("p",Ce,B(w.default_answer),1))]),_:2},1032,["content-loading","label"]))),128))]),_:1})])}}},ke={},Ee={class:"col-span-12 xl:col-span-9 xxl:col-span-10"},Ie={class:"flex justify-between mt-1 mb-6"},De={class:"grid col-span-12 mt-6 text-center xl:mt-0 sm:grid-cols-4 xl:text-right xl:col-span-3 xl:grid-cols-1 xxl:col-span-2"},Se={class:"flex flex-col items-center justify-center px-6 py-2 lg:justify-end lg:items-end"},Ve={class:"flex flex-col items-center justify-center px-6 py-2 lg:justify-end lg:items-end"},Ae={class:"flex flex-col items-center justify-center px-6 py-2 lg:justify-end lg:items-end"},Fe={class:"flex flex-col items-center justify-center px-6 py-2 lg:justify-end lg:items-end"};function Pe(L,T){const t=i("BaseContentPlaceholdersText"),u=i("BaseContentPlaceholdersBox"),c=i("BaseContentPlaceholders");return l(),m(c,{class:"grid grid-cols-12"},{default:n(()=>[r("div",Ee,[r("div",Ie,[e(t,{class:"h-10 w-36",lines:1}),e(t,{class:"h-10 w-40 !mt-0",lines:1})]),e(u,{class:"h-80 xl:h-72 sm:w-full"})]),r("div",De,[r("div",Se,[e(t,{class:"h-3 w-14 xl:h-4",lines:1}),e(t,{class:"w-20 h-5 xl:h-6",lines:1})]),r("div",Ve,[e(t,{class:"h-3 w-14 xl:h-4",lines:1}),e(t,{class:"w-20 h-5 xl:h-6",lines:1})]),r("div",Ae,[e(t,{class:"h-3 w-14 xl:h-4",lines:1}),e(t,{class:"w-20 h-5 xl:h-6",lines:1})]),r("div",Fe,[e(t,{class:"h-3 w-14 xl:h-4",lines:1}),e(t,{class:"w-20 h-5 xl:h-6",lines:1})])])]),_:1})}const je=te(ke,[["render",Pe]]),Le={key:1,class:"grid grid-cols-12"},Re={class:"col-span-12 xl:col-span-9 xxl:col-span-10"},Me={class:"flex justify-between mt-1 mb-6"},Ne={class:"flex items-center"},Oe={class:"w-40 h-10"},Ue={class:"grid col-span-12 mt-6 text-center xl:mt-0 sm:grid-cols-4 xl:text-right xl:col-span-3 xl:grid-cols-1 xxl:col-span-2"},He={class:"px-6 py-2"},ze={class:"text-xs leading-5 lg:text-sm"},Ye=r("br",null,null,-1),Xe={key:0,class:"block mt-1 text-xl font-semibold leading-8"},qe={class:"px-6 py-2"},Ge={class:"text-xs leading-5 lg:text-sm"},Je=r("br",null,null,-1),Ke={key:0,class:"block mt-1 text-xl font-semibold leading-8",style:{color:"#00c99c"}},Qe={class:"px-6 py-2"},We={class:"text-xs leading-5 lg:text-sm"},Ze=r("br",null,null,-1),et={key:0,class:"block mt-1 text-xl font-semibold leading-8",style:{color:"#fb7178"}},tt={class:"px-6 py-2"},st={class:"text-xs leading-5 lg:text-sm"},at=r("br",null,null,-1),nt={key:0,class:"block mt-1 text-xl font-semibold leading-8",style:{color:"#E72027"}},lt={__name:"CustomerChart",setup(L){se();const T=M();J("utils");const t=N();let u=F(!1),c=R({}),s=R({}),_=R(["This year","Previous year"]),y=F("This year");const g=k(()=>c.expenseTotals?c.expenseTotals:[]),I=k(()=>c.netProfits?c.netProfits:[]),f=k(()=>c&&c.months?c.months:[]),w=k(()=>c.receiptTotals?c.receiptTotals:[]),v=k(()=>c.invoiceTotals?c.invoiceTotals:[]),C=k(()=>t.params.id);ae(()=>C.value,d=>{d&&t.name==="customers.view"&&D(),y.value="This year"},{immediate:!0});async function D(){u.value=!1;let d=await T.fetchViewCustomer({id:t.params.id});d.data&&(Object.assign(c,d.data.meta.chartData),Object.assign(s,d.data.data)),u.value=!0}async function x(d){let o={id:t.params.id};d==="Previous year"?o.previous_year=!0:o.this_year=!0;let h=await T.fetchViewCustomer(o);return h.data.meta.chartData&&Object.assign(c,h.data.meta.chartData),!0}return(d,o)=>{const h=i("BaseIcon"),E=i("BaseMultiselect"),A=i("BaseFormatMoney"),P=i("BaseCard");return l(),m(P,{class:"flex flex-col mt-6"},{default:n(()=>[a(T).isFetchingViewData?(l(),m(je,{key:0})):(l(),$("div",Le,[r("div",Re,[r("div",Me,[r("h6",Ne,[e(h,{name:"ChartSquareBarIcon",class:"h-5 text-primary-400"}),V(" "+B(d.$t("dashboard.monthly_chart.title")),1)]),r("div",Oe,[e(E,{modelValue:a(y),"onUpdate:modelValue":o[0]||(o[0]=j=>ne(y)?y.value=j:y=j),options:a(_),"allow-empty":!1,"show-labels":!1,placeholder:d.$t("dashboard.select_year"),"can-deselect":!1,onSelect:x},null,8,["modelValue","options","placeholder"])])]),a(u)?(l(),m(ie,{key:0,invoices:v.value,expenses:g.value,receipts:w.value,income:I.value,labels:f.value,class:"sm:w-full"},null,8,["invoices","expenses","receipts","income","labels"])):p("",!0)]),r("div",Ue,[r("div",He,[r("span",ze,B(d.$t("dashboard.chart_info.total_sales")),1),Ye,a(u)?(l(),$("span",Xe,[e(A,{amount:a(c).salesTotal,currency:a(s).currency},null,8,["amount","currency"])])):p("",!0)]),r("div",qe,[r("span",Ge,B(d.$t("dashboard.chart_info.total_receipts")),1),Je,a(u)?(l(),$("span",Ke,[e(A,{amount:a(c).totalExpenses,currency:a(s).currency},null,8,["amount","currency"])])):p("",!0)]),r("div",Qe,[r("span",We,B(d.$t("dashboard.chart_info.total_expense")),1),Ze,a(u)?(l(),$("span",et,[e(A,{amount:a(c).totalExpenses,currency:a(s).currency},null,8,["amount","currency"])])):p("",!0)]),r("div",tt,[r("span",st,B(d.$t("dashboard.chart_info.net_income")),1),at,a(u)?(l(),$("span",nt,[e(A,{amount:a(c).netProfit,currency:a(s).currency},null,8,["amount","currency"])])):p("",!0)])])])),e(Te)]),_:1})}}},ut={__name:"View",setup(L){J("utils"),le();const T=M(),t=oe();Y();const u=re(),c=N();F(null);const s=k(()=>T.selectedViewCustomer.customer?T.selectedViewCustomer.customer.name:"");let _=k(()=>T.isFetchingViewData);function y(){return t.hasAbilities([S.CREATE_ESTIMATE,S.CREATE_INVOICE,S.CREATE_PAYMENT,S.CREATE_EXPENSE])}function g(){return t.hasAbilities([S.DELETE_CUSTOMER,S.EDIT_CUSTOMER])}function I(){u.push("/admin/customers")}return(f,w)=>{const v=i("BaseButton"),C=i("router-link"),D=i("BaseIcon"),x=i("BaseDropdownItem"),d=i("BaseDropdown"),o=i("BasePageHeader"),h=i("BasePage");return l(),m(h,{class:"xl:pl-96"},{default:n(()=>[e(o,{title:s.value},{actions:n(()=>[a(t).hasAbilities(a(S).EDIT_CUSTOMER)?(l(),m(C,{key:0,to:`/admin/customers/${a(c).params.id}/edit`},{default:n(()=>[e(v,{class:"mr-3",variant:"primary-outline","content-loading":a(_)},{default:n(()=>[V(B(f.$t("general.edit")),1)]),_:1},8,["content-loading"])]),_:1},8,["to"])):p("",!0),y()?(l(),m(d,{key:1,position:"bottom-end","content-loading":a(_)},{activator:n(()=>[e(v,{class:"mr-3",variant:"primary","content-loading":a(_)},{default:n(()=>[V(B(f.$t("customers.new_transaction")),1)]),_:1},8,["content-loading"])]),default:n(()=>[a(t).hasAbilities(a(S).CREATE_ESTIMATE)?(l(),m(C,{key:0,to:`/admin/estimates/create?customer=${f.$route.params.id}`},{default:n(()=>[e(x,{class:""},{default:n(()=>[e(D,{name:"DocumentIcon",class:"mr-3 text-gray-600"}),V(" "+B(f.$t("estimates.new_estimate")),1)]),_:1})]),_:1},8,["to"])):p("",!0),a(t).hasAbilities(a(S).CREATE_INVOICE)?(l(),m(C,{key:1,to:`/admin/invoices/create?customer=${f.$route.params.id}`},{default:n(()=>[e(x,null,{default:n(()=>[e(D,{name:"DocumentTextIcon",class:"mr-3 text-gray-600"}),V(" "+B(f.$t("invoices.new_invoice")),1)]),_:1})]),_:1},8,["to"])):p("",!0),a(t).hasAbilities(a(S).CREATE_PAYMENT)?(l(),m(C,{key:2,to:`/admin/payments/create?customer=${f.$route.params.id}`},{default:n(()=>[e(x,null,{default:n(()=>[e(D,{name:"CreditCardIcon",class:"mr-3 text-gray-600"}),V(" "+B(f.$t("payments.new_payment")),1)]),_:1})]),_:1},8,["to"])):p("",!0),a(t).hasAbilities(a(S).CREATE_EXPENSE)?(l(),m(C,{key:3,to:`/admin/expenses/create?customer=${f.$route.params.id}`},{default:n(()=>[e(x,null,{default:n(()=>[e(D,{name:"CalculatorIcon",class:"mr-3 text-gray-600"}),V(" "+B(f.$t("expenses.new_expense")),1)]),_:1})]),_:1},8,["to"])):p("",!0)]),_:1},8,["content-loading"])):p("",!0),g()?(l(),m(ue,{key:2,class:G({"ml-3":a(_)}),row:a(T).selectedViewCustomer,"load-data":I},null,8,["class","row"])):p("",!0)]),_:1},8,["title"]),e(xe),e(lt)]),_:1})}}};export{ut as default};
