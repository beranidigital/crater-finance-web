import{D as Y,aq as Z,u as ee,C as te,f as ae,e as se,g as p,F as oe,l as M,h as $,i as I,j as le,k as ne,r as u,o as m,n as k,w as n,b as c,q as b,t as y,m as e,a as s,c as C,I as V}from"./main-55335c70.js";import{u as re}from"./mail-sender-1c84da3c.js";import{_ as ie}from"./FeedbackAlert-4879c716.js";const de={class:"flex justify-between w-full"},ue={key:0,action:""},me={key:0,class:"px-8 py-8 sm:p-6"},ce={key:1},pe={class:"mt-4"},ve={class:"-mx-2 -my-1.5 flex"},_e={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},fe={key:1},be={class:"my-6 mx-4 border border-gray-200 relative"},ye=["src"],ge={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},Se={__name:"SendEstimateModal",emits:["update"],setup(he,{emit:D}){const v=Y(),E=Z(),F=ee(),P=te(),G=re(),R=ae(),{t:_}=se(),r=p(!1),q=p(""),g=p(!1),w=p(null),B=p(!1);p(null);const L=p(["customer","customerCustom","estimate","estimateCustom","company"]);let o=oe({id:null,mail_sender_id:null,to:null,subject:"New Estimate",body:null});const z=D,A=M(()=>v.active&&v.componentName==="SendEstimateModal"),x=M(()=>v.data),O={mail_sender_id:{required:$.withMessage(_("validation.required"),I)},to:{required:$.withMessage(_("validation.required"),I),email:$.withMessage(_("validation.email_incorrect"),le)},subject:{required:$.withMessage(_("validation.required"),I)},body:{required:$.withMessage(_("validation.required"),I)}},l=ne(O,M(()=>o));function T(){g.value=!1}async function X(){o.id=v.id,x.value&&(o.to=x.value.customer.email),o.body=P.selectedCompanySettings.estimate_mail_body,B.value=!0;let a=await G.fetchMailSenders({limit:"all"});if(a.data){w.value=a.data.data;let t=a.data.data.find(d=>d.is_default==!0);o.mail_sender_id=t?t.id:null,B.value=!1}}async function N(){if(l.value.$touch(),l.value.$invalid)return!0;try{if(r.value=!0,!g.value){const d=await E.previewEstimate(o);r.value=!1,g.value=!0;var a=new Blob([d.data],{type:"text/html"});q.value=URL.createObjectURL(a);return}const t=await E.sendEstimate(o);if(r.value=!1,t.data.success)return z("update"),f(),!0}catch(t){console.error(t),r.value=!1,F.showNotification({type:"error",message:_("estimates.something_went_wrong")})}}function f(){v.closeModal(),setTimeout(()=>{l.value.$reset(),g.value=!1,q.value=null},300)}const j=M(()=>w.value&&w.value.length);function H(){f(),R.push("/admin/settings/mail-sender")}return(a,t)=>{const d=u("BaseIcon"),J=u("BaseMultiselect"),S=u("BaseInputGroup"),U=u("BaseInput"),K=u("BaseCustomInput"),Q=u("BaseInputGrid"),h=u("BaseButton"),W=u("BaseModal");return m(),k(W,{show:A.value,onClose:f,onOpen:X},{header:n(()=>[c("div",de,[b(y(e(v).title)+" ",1),s(d,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:f})])]),default:n(()=>[g.value?(m(),C("div",fe,[c("div",be,[s(h,{class:"absolute top-4 right-4",disabled:r.value,variant:"primary-outline",onClick:T},{default:n(()=>[s(d,{name:"PencilIcon",class:"h-5 mr-2"}),b(" Edit ")]),_:1},8,["disabled"]),c("iframe",{src:q.value,frameborder:"0",class:"w-full",style:{"min-height":"500px"}},null,8,ye)]),c("div",ge,[s(h,{class:"mr-3",variant:"primary-outline",type:"button",onClick:f},{default:n(()=>[b(y(a.$t("general.cancel")),1)]),_:1}),s(h,{loading:r.value,disabled:r.value,variant:"primary",type:"button",onClick:N},{default:n(()=>[r.value?V("",!0):(m(),k(d,{key:0,name:"PaperAirplaneIcon",class:"mr-2"})),b(" "+y(a.$t("general.send")),1)]),_:1},8,["loading","disabled"])])])):(m(),C("form",ue,[j.value?(m(),C("div",me,[s(Q,{layout:"one-column"},{default:n(()=>[s(S,{label:a.$tc("settings.mail_sender.title",1),required:"",error:e(l).mail_sender_id.$error&&e(l).mail_sender_id.$errors[0].$message},{default:n(()=>[s(J,{modelValue:e(o).mail_sender_id,"onUpdate:modelValue":t[0]||(t[0]=i=>e(o).mail_sender_id=i),invalid:e(l).mail_sender_id.$error,label:"name",options:w.value,"value-prop":"id","can-deselect":!1,"can-clear":!1,placeholder:a.$t("settings.mail_sender.select_mail_sender"),searchable:"","track-by":"name","content-loading":B.value},null,8,["modelValue","invalid","options","placeholder","content-loading"])]),_:1},8,["label","error"]),s(S,{label:a.$t("general.to"),required:"",error:e(l).to.$error&&e(l).to.$errors[0].$message},{default:n(()=>[s(U,{modelValue:e(o).to,"onUpdate:modelValue":t[1]||(t[1]=i=>e(o).to=i),type:"text",invalid:e(l).to.$error,onInput:t[2]||(t[2]=i=>e(l).to.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),s(S,{label:a.$t("general.subject"),required:"",error:e(l).subject.$error&&e(l).subject.$errors[0].$message},{default:n(()=>[s(U,{modelValue:e(o).subject,"onUpdate:modelValue":t[3]||(t[3]=i=>e(o).subject=i),type:"text",invalid:e(l).subject.$error,onInput:t[4]||(t[4]=i=>e(l).subject.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),s(S,{label:a.$t("general.body"),required:""},{default:n(()=>[s(K,{modelValue:e(o).body,"onUpdate:modelValue":t[5]||(t[5]=i=>e(o).body=i),fields:L.value},null,8,["modelValue","fields"])]),_:1},8,["label"])]),_:1})])):!j.value&&!B.value?(m(),C("div",ce,[s(ie,{title:a.$t("settings.mail_sender.no_mail_sender_found"),description:a.$t("settings.mail_sender.no_mail_sender_found_description"),type:"warning"},{action:n(()=>[c("div",pe,[c("div",ve,[c("button",{type:"button",class:"bg-yellow-50 px-2 py-1.5 rounded-md text-sm font-medium text-yellow-800 hover:bg-yellow-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-yellow-50 focus:ring-yellow-600",onClick:H},y(a.$t("settings.mail_sender.manage_mail_sender")),1)])])]),_:1},8,["title","description"])])):V("",!0),c("div",_e,[s(h,{class:"mr-3",variant:"primary-outline",type:"button",onClick:f},{default:n(()=>[b(y(a.$t("general.cancel")),1)]),_:1}),j.value?(m(),k(h,{key:0,loading:r.value,disabled:r.value,variant:"primary",type:"button",class:"mr-3",onClick:N},{default:n(()=>[r.value?V("",!0):(m(),k(d,{key:0,name:"PhotographIcon",class:"h-5 mr-2"})),b(" "+y(a.$t("general.preview")),1)]),_:1},8,["loading","disabled"])):V("",!0)])]))]),_:1},8,["show"])}}};export{Se as _};
