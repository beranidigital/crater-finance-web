import{a5 as W,u as J,e as K,J as se,f as X,K as le,D as Q,a3 as re,r as d,o as i,n as c,w as n,m as e,a,O as x,q as p,t as y,I as _,C as ie,g as I,F as de,l as A,h as E,i as U,j as ue,k as ce,b as $,c as L,H as me}from"./main-55335c70.js";import{u as Z}from"./payment-79639113.js";import{u as pe}from"./mail-sender-1c84da3c.js";import{_ as ye}from"./FeedbackAlert-4879c716.js";const De={__name:"PaymentIndexDropdown",props:{row:{type:Object,default:null},table:{type:Object,default:null},contentLoading:{type:Boolean,default:!1}},setup(v){const k=v,z=W(),g=J(),{t:b}=K(),O=Z(),S=se(),w=X(),r=le(),D=Q(),B=re("utils");function M(t){z.openDialog({title:b("general.are_you_sure"),message:b("payments.confirm_delete",1),yesLabel:b("general.ok"),noLabel:b("general.cancel"),variant:"danger",size:"lg",hideNoButton:!1}).then(async m=>{if(m)return await O.deletePayment({ids:[t]}),w.push("/admin/payments"),k.table&&k.table.refresh(),!0})}function P(){var m;let t=`${window.location.origin}/payments/pdf/${(m=k.row)==null?void 0:m.unique_hash}`;B.copyTextToClipboard(t),g.showNotification({type:"success",message:b("general.copied_pdf_url_clipboard")})}async function R(t){D.openModal({title:b("payments.send_payment"),componentName:"SendPaymentModal",id:t.id,data:t,variant:"lg"})}return(t,m)=>{const f=d("BaseIcon"),N=d("BaseButton"),Y=d("BaseDropdown-item"),o=d("BaseDropdownItem"),j=d("router-link"),F=d("BaseDropdown");return i(),c(F,{"content-loading":v.contentLoading},{activator:n(()=>[e(S).name==="payments.view"?(i(),c(N,{key:0,variant:"primary"},{default:n(()=>[a(f,{name:"DotsHorizontalIcon",class:"h-5 text-white"})]),_:1})):(i(),c(f,{key:1,name:"DotsHorizontalIcon",class:"h-5 text-gray-500"}))]),default:n(()=>[e(S).name==="payments.view"&&e(r).hasAbilities(e(x).VIEW_PAYMENT)?(i(),c(Y,{key:0,class:"rounded-md",onClick:P},{default:n(()=>[a(f,{name:"LinkIcon",class:"w-5 h-5 mr-3 text-gray-400 group-hover:text-gray-500"}),p(" "+y(t.$t("general.copy_pdf_url")),1)]),_:1})):_("",!0),e(r).hasAbilities(e(x).EDIT_PAYMENT)?(i(),c(j,{key:1,to:`/admin/payments/${v.row.id}/edit`},{default:n(()=>[a(o,null,{default:n(()=>[a(f,{name:"PencilIcon",class:"w-5 h-5 mr-3 text-gray-400 group-hover:text-gray-500"}),p(" "+y(t.$t("general.edit")),1)]),_:1})]),_:1},8,["to"])):_("",!0),e(S).name!=="payments.view"&&e(r).hasAbilities(e(x).VIEW_PAYMENT)?(i(),c(j,{key:2,to:`/admin/payments/${v.row.id}/view`},{default:n(()=>[a(o,null,{default:n(()=>[a(f,{name:"EyeIcon",class:"w-5 h-5 mr-3 text-gray-400 group-hover:text-gray-500"}),p(" "+y(t.$t("general.view")),1)]),_:1})]),_:1},8,["to"])):_("",!0),v.row.status!=="SENT"&&e(S).name!=="payments.view"&&e(r).hasAbilities(e(x).SEND_PAYMENT)?(i(),c(o,{key:3,onClick:m[0]||(m[0]=q=>R(v.row))},{default:n(()=>[a(f,{name:"PaperAirplaneIcon",class:"w-5 h-5 mr-3 text-gray-400 group-hover:text-gray-500"}),p(" "+y(t.$t("payments.send_payment")),1)]),_:1})):_("",!0),e(r).hasAbilities(e(x).DELETE_PAYMENT)?(i(),c(o,{key:4,onClick:m[1]||(m[1]=q=>M(v.row.id))},{default:n(()=>[a(f,{name:"TrashIcon",class:"w-5 h-5 mr-3 text-gray-400 group-hover:text-gray-500"}),p(" "+y(t.$t("general.delete")),1)]),_:1})):_("",!0)]),_:1},8,["content-loading"])}}},fe={class:"flex justify-between w-full"},_e={key:0,action:""},ve={key:0,class:"px-8 py-8 sm:p-6"},ge={key:1},be={class:"mt-4"},we={class:"-mx-2 -my-1.5 flex"},he={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},$e={key:1},Be={class:"my-6 mx-4 border border-gray-200 relative"},Ie=["src"],ke={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},Ve={__name:"SendPaymentModal",setup(v){const k=Z(),z=ie(),g=Q(),b=J();W();const O=pe(),S=X(),{t:w}=K();let r=I(!1);const D=I(""),B=I(!1),M=I(null),P=I(!1);I(null);const R=I(["customer","customerCustom","payments","paymentsCustom","company"]),t=de({id:null,mail_sender_id:null,to:null,subject:"New Payment",body:null}),m=A(()=>g.active&&g.componentName==="SendPaymentModal"),f=A(()=>g.title),N=A(()=>g.data),Y={mail_sender_id:{required:E.withMessage(w("validation.required"),U)},to:{required:E.withMessage(w("validation.required"),U),email:E.withMessage(w("validation.email_incorrect"),ue)},subject:{required:E.withMessage(w("validation.required"),U)},body:{required:E.withMessage(w("validation.required"),U)}},o=ce(Y,t);function j(){B.value=!1}async function F(){t.id=g.id,N.value&&(t.to=N.value.customer.email),t.body=z.selectedCompanySettings.payment_mail_body,P.value=!0;let l=await O.fetchMailSenders({limit:"all"});if(l.data){M.value=l.data.data;let s=l.data.data.find(h=>h.is_default==!0);t.mail_sender_id=s?s.id:null,P.value=!1}}async function q(){if(o.value.$touch(),o.value.$invalid)return!0;try{if(r.value=!0,!B.value){const h=await k.previewPayment(t);r.value=!1,B.value=!0;var l=new Blob([h.data],{type:"text/html"});D.value=URL.createObjectURL(l);return}const s=await k.sendEmail(t);if(r.value=!1,s.data.success)return C(),!0}catch{r.value=!1,b.showNotification({type:"error",message:w("payments.something_went_wrong")})}}function C(){setTimeout(()=>{o.value.$reset(),B.value=!1,D.value=null,g.resetModalData()},300)}const G=A(()=>M.value&&M.value.length);function ee(){C(),S.push("/admin/settings/mail-sender")}return(l,s)=>{const h=d("BaseIcon"),te=d("BaseMultiselect"),T=d("BaseInputGroup"),H=d("BaseInput"),ae=d("BaseCustomInput"),ne=d("BaseInputGrid"),V=d("BaseButton"),oe=d("BaseModal");return i(),c(oe,{show:m.value,onClose:C,onOpen:F},{header:n(()=>[$("div",fe,[p(y(f.value)+" ",1),a(h,{name:"XIcon",class:"w-6 h-6 text-gray-500 cursor-pointer",onClick:C})])]),default:n(()=>[B.value?(i(),L("div",$e,[$("div",Be,[a(V,{class:"absolute top-4 right-4",disabled:e(r),variant:"primary-outline",onClick:j},{default:n(()=>[a(h,{name:"PencilIcon",class:"h-5 mr-2"}),p(" Edit ")]),_:1},8,["disabled"]),$("iframe",{src:D.value,frameborder:"0",class:"w-full",style:{"min-height":"500px"}},null,8,Ie)]),$("div",ke,[a(V,{class:"mr-3",variant:"primary-outline",type:"button",onClick:C},{default:n(()=>[p(y(l.$t("general.cancel")),1)]),_:1}),a(V,{loading:e(r),disabled:e(r),variant:"primary",type:"button",onClick:s[6]||(s[6]=u=>q())},{default:n(()=>[e(r)?_("",!0):(i(),c(h,{key:0,name:"PaperAirplaneIcon",class:"h-5 mr-2"})),p(" "+y(l.$t("general.send")),1)]),_:1},8,["loading","disabled"])])])):(i(),L("form",_e,[G.value?(i(),L("div",ve,[a(ne,{layout:"one-column",class:"col-span-7"},{default:n(()=>[a(T,{label:l.$tc("settings.mail_sender.title",1),required:"",error:e(o).mail_sender_id.$error&&e(o).mail_sender_id.$errors[0].$message},{default:n(()=>[a(te,{modelValue:t.mail_sender_id,"onUpdate:modelValue":s[0]||(s[0]=u=>t.mail_sender_id=u),invalid:e(o).mail_sender_id.$error,label:"name",options:M.value,"value-prop":"id","can-deselect":!1,"can-clear":!1,placeholder:l.$t("settings.mail_sender.select_mail_sender"),searchable:"","track-by":"name","content-loading":P.value},null,8,["modelValue","invalid","options","placeholder","content-loading"])]),_:1},8,["label","error"]),a(T,{label:l.$t("general.to"),required:"",error:e(o).to.$error&&e(o).to.$errors[0].$message},{default:n(()=>[a(H,{modelValue:t.to,"onUpdate:modelValue":s[1]||(s[1]=u=>t.to=u),type:"text",invalid:e(o).to.$error,onInput:s[2]||(s[2]=u=>e(o).to.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),a(T,{error:e(o).subject.$error&&e(o).subject.$errors[0].$message,label:l.$t("general.subject"),required:""},{default:n(()=>[a(H,{modelValue:t.subject,"onUpdate:modelValue":s[3]||(s[3]=u=>t.subject=u),type:"text",invalid:e(o).subject.$error,onInput:s[4]||(s[4]=u=>e(o).subject.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["error","label"]),a(T,{label:l.$t("general.body"),error:e(o).body.$error&&e(o).body.$errors[0].$message,required:""},{default:n(()=>[a(ae,{modelValue:t.body,"onUpdate:modelValue":s[5]||(s[5]=u=>t.body=u),fields:R.value},null,8,["modelValue","fields"])]),_:1},8,["label","error"])]),_:1})])):!G.value&&!P.value?(i(),L("div",ge,[a(ye,{title:l.$t("settings.mail_sender.no_mail_sender_found"),description:l.$t("settings.mail_sender.no_mail_sender_found_description"),type:"warning"},{action:n(()=>[$("div",be,[$("div",we,[$("button",{type:"button",class:"bg-yellow-50 px-2 py-1.5 rounded-md text-sm font-medium text-yellow-800 hover:bg-yellow-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-yellow-50 focus:ring-yellow-600",onClick:ee},y(l.$t("settings.mail_sender.manage_mail_sender")),1)])])]),_:1},8,["title","description"])])):_("",!0),$("div",he,[a(V,{class:"mr-3",variant:"primary-outline",type:"button",onClick:C},{default:n(()=>[p(y(l.$t("general.cancel")),1)]),_:1}),G.value?(i(),c(V,{key:0,loading:e(r),disabled:e(r),variant:"primary",type:"button",class:"mr-3",onClick:q},{left:n(u=>[e(r)?_("",!0):(i(),c(h,{key:0,class:me(u.class),name:"PhotographIcon"},null,8,["class"]))]),default:n(()=>[p(" "+y(l.$t("general.preview")),1)]),_:1},8,["loading","disabled"])):_("",!0)])]))]),_:1},8,["show"])}}};export{Ve as _,De as a};
