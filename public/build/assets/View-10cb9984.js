import{aP as U,e as P,J as z,g as x,F as Y,l as N,N as Z,r as l,o as d,c as F,b as y,a as e,w as o,t as I,n as b,L as M,M as ee,q as L,H as te,I as w,a3 as ne,f as q,K as G,a4 as ae,m as i,O as T,A as oe,a5 as re}from"./main-55335c70.js";import{L as se}from"./LoadingIcon-fa016bf5.js";import{_ as ie}from"./InvoiceIndexDropdown-746d5155.js";import{_ as le}from"./SendInvoiceModal-986a46f6.js";import{_ as ce}from"./RecurringInvoiceIndexDropdown-d25edd23.js";import"./mail-sender-1c84da3c.js";import"./FeedbackAlert-4879c716.js";const ue={class:"fixed top-0 left-0 hidden h-full pt-16 pb-[6.4rem] ml-56 bg-white xl:ml-64 w-88 xl:block"},de={class:"flex items-center justify-between px-4 pt-8 pb-2 border border-gray-200 border-solid height-full"},me={class:"mb-6"},_e={class:"flex mb-6 ml-3",role:"group","aria-label":"First group"},ve={class:"px-2 py-1 pb-2 mb-1 mb-2 text-sm border-b border-gray-200 border-solid"},ge={class:"flex-2"},pe={class:"mt-1 mb-2 text-xs not-italic font-medium leading-5 text-gray-600"},fe={class:"flex-1 whitespace-nowrap right"},ye={class:"text-sm not-italic font-normal leading-5 text-right text-gray-600 est-date"},be={key:0,class:"flex justify-center p-4 items-center"},Ie={key:1,class:"flex justify-center px-4 mt-5 text-sm text-gray-600"},Be={__name:"RecurringInvoiceViewSidebar",setup(H){const n=U();P();const p=z(),r=x(!1),m=x(null),v=x(1),c=x(1),R=x(null),t=Y({orderBy:null,orderByField:null,searchText:null}),f=N(()=>t.orderBy==="asc"||t.orderBy==null);function k(a){return p.params.id==a}async function B(a,_=!1){if(r.value)return;let g={};t.searchText!==""&&t.searchText!==null&&t.searchText!==void 0&&(g.search=t.searchText),t.orderBy!==null&&t.orderBy!==void 0&&(g.orderBy=t.orderBy),t.orderByField!==null&&t.orderByField!==void 0&&(g.orderByField=t.orderByField),r.value=!0;let S=await n.fetchRecurringInvoices({page:a,...g});r.value=!1,m.value=m.value?m.value:[],m.value=[...m.value,...S.data.data],v.value=a||1,c.value=S.data.meta.last_page;let h=m.value.find(E=>E.id==p.params.id);_==!1&&!h&&v.value<c.value&&Object.keys(g).length===0&&B(++v.value),h&&setTimeout(()=>{_==!1&&V()},500)}function V(){const a=document.getElementById(`recurring-invoice-${p.params.id}`);a&&(a.scrollIntoView({behavior:"smooth"}),a.classList.add("shake"),$())}function $(){R.value.addEventListener("scroll",a=>{a.target.scrollTop>0&&a.target.scrollTop+a.target.clientHeight>a.target.scrollHeight-200&&v.value<c.value&&B(++v.value,!0)})}async function s(){m.value=[],B()}function O(){return t.orderBy==="asc"?(t.orderBy="desc",s(),!0):(t.orderBy="asc",s(),!0)}return B(),s=Z.debounce(s,500),(a,_)=>{var j;const g=l("BaseIcon"),S=l("BaseInput"),h=l("BaseButton"),E=l("BaseRadio"),C=l("BaseInputGroup"),D=l("BaseDropdownItem"),A=l("BaseDropdown"),J=l("BaseText"),K=l("BaseRecurringInvoiceStatusBadge"),W=l("BaseFormatMoney"),Q=l("router-link");return d(),F("div",ue,[y("div",de,[y("div",me,[e(S,{modelValue:t.searchText,"onUpdate:modelValue":_[0]||(_[0]=u=>t.searchText=u),placeholder:a.$t("general.search"),type:"text",variant:"gray",onInput:_[1]||(_[1]=u=>s())},{right:o(()=>[e(g,{name:"SearchIcon",class:"h-5 text-gray-400"})]),_:1},8,["modelValue","placeholder"])]),y("div",_e,[e(A,{class:"ml-3",position:"bottom-start"},{activator:o(()=>[e(h,{size:"md",variant:"gray"},{default:o(()=>[e(g,{name:"FilterIcon",class:"h-5"})]),_:1})]),default:o(()=>[y("div",ve,I(a.$t("general.sort_by")),1),e(D,{class:"flex px-1 py-2 cursor-pointer"},{default:o(()=>[e(C,{class:"-mt-3 font-normal"},{default:o(()=>[e(E,{id:"filter_next_invoice_date",modelValue:t.orderByField,"onUpdate:modelValue":[_[2]||(_[2]=u=>t.orderByField=u),s],label:a.$t("recurring_invoices.next_invoice_date"),size:"sm",name:"filter",value:"next_invoice_at"},null,8,["modelValue","label"])]),_:1})]),_:1}),e(D,{class:"flex px-1 py-2 cursor-pointer"},{default:o(()=>[e(C,{class:"-mt-3 font-normal"},{default:o(()=>[e(E,{id:"filter_start_date",modelValue:t.orderByField,"onUpdate:modelValue":[_[3]||(_[3]=u=>t.orderByField=u),s],label:a.$t("recurring_invoices.starts_at"),value:"starts_at",size:"sm",name:"filter"},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1}),e(h,{class:"ml-1",size:"md",variant:"gray",onClick:O},{default:o(()=>[f.value?(d(),b(g,{key:0,name:"SortAscendingIcon",class:"h-5"})):(d(),b(g,{key:1,name:"SortDescendingIcon",class:"h-5"}))]),_:1})])]),y("div",{ref_key:"invoiceListSection",ref:R,class:"h-full overflow-y-scroll border-l border-gray-200 border-solid base-scroll"},[(d(!0),F(M,null,ee(m.value,(u,X)=>(d(),F("div",{key:X},[u?(d(),b(Q,{key:0,id:"recurring-invoice-"+u.id,to:`/admin/recurring-invoices/${u.id}/view`,class:te(["flex justify-between side-invoice p-4 cursor-pointer hover:bg-gray-100 items-center border-l-4 border-transparent",{"bg-gray-100 border-l-4 border-primary-500 border-solid":k(u.id)}]),style:{"border-bottom":"1px solid rgba(185, 193, 209, 0.41)"}},{default:o(()=>[y("div",ge,[e(J,{text:u.customer.name,length:30,class:"pr-2 mb-2 text-sm not-italic font-normal leading-5 text-black capitalize truncate"},null,8,["text"]),y("div",pe,I(u.invoice_number),1),e(K,{status:u.status,class:"px-1 text-xs"},{default:o(()=>[L(I(u.status),1)]),_:2},1032,["status"])]),y("div",fe,[e(W,{class:"block mb-2 text-xl not-italic font-semibold leading-8 text-right text-gray-900",amount:u.total,currency:u.customer.currency},null,8,["amount","currency"]),y("div",ye,I(u.formatted_starts_at),1)])]),_:2},1032,["id","to","class"])):w("",!0)]))),128)),r.value?(d(),F("div",be,[e(se,{class:"h-6 m-1 animate-spin text-primary-400"})])):w("",!0),!((j=m.value)!=null&&j.length)&&!r.value?(d(),F("p",Ie,I(a.$t("invoices.no_matching_invoices")),1)):w("",!0)],512)])}}},he={class:"relative table-container"},xe={__name:"Invoices",setup(H){const n=U(),p=x(null);x(null),ne("$utils");const{t:r}=P();x(null),q();const m=G(),v=N(()=>[{key:"invoice_date",label:r("invoices.date"),thClass:"extra",tdClass:"font-medium text-gray-900"},{key:"invoice_number",label:r("invoices.invoice")},{key:"customer.name",label:r("invoices.customer")},{key:"status",label:r("invoices.status")},{key:"total",label:r("invoices.total")},{key:"actions",label:r("invoices.action"),tdClass:"text-right text-sm font-medium",thClass:"text-right",sortable:!1}]);function c(){return m.hasAbilities([T.DELETE_INVOICE,T.EDIT_INVOICE,T.VIEW_INVOICE,T.SEND_INVOICE])}function R(t){let f=n.newRecurringInvoice.invoices.findIndex(k=>k.id===t);n.newRecurringInvoice.invoices[f]&&(n.newRecurringInvoice.invoices[f].status="SENT")}return(t,f)=>{const k=l("router-link"),B=l("BaseFormatMoney"),V=l("BaseInvoiceStatusBadge"),$=l("BaseTable");return d(),F(M,null,[e(le,{onUpdate:R}),y("div",he,[e($,{ref_key:"table",ref:p,data:i(n).newRecurringInvoice.invoices,columns:v.value,loading:i(n).isFetchingViewData,"placeholder-count":5,class:"mt-5"},ae({"cell-invoice_number":o(({row:s})=>[e(k,{to:{path:`/admin/invoices/${s.data.id}/view`},class:"font-medium text-primary-500"},{default:o(()=>[L(I(s.data.invoice_number),1)]),_:2},1032,["to"])]),"cell-total":o(({row:s})=>[e(B,{amount:s.data.due_amount,currency:s.data.currency},null,8,["amount","currency"])]),"cell-status":o(({row:s})=>[e(V,{status:s.data.status,class:"px-3 py-1"},{default:o(()=>[L(I(s.data.status),1)]),_:2},1032,["status"])]),_:2},[c()?{name:"cell-actions",fn:o(({row:s})=>[e(ie,{row:s.data,table:p.value},null,8,["row","table"])]),key:"0"}:void 0]),1032,["data","columns","loading"])])],64)}}},we={__name:"RecurringInvoiceInfo",setup(H){const n=U(),p=z();let r=N(()=>n.isFetchingViewData);const m=N(()=>p.params.id);oe(()=>m.value,c=>{c&&p.name==="recurring-invoices.view"&&v()},{immediate:!0});async function v(){await n.fetchRecurringInvoice(p.params.id)}return(c,R)=>{const t=l("BaseHeading"),f=l("BaseDescriptionListItem"),k=l("BaseDescriptionList"),B=l("BaseCard");return d(),b(B,{class:"mt-10"},{default:o(()=>[e(t,null,{default:o(()=>[L(I(c.$t("customers.basic_info")),1)]),_:1}),e(k,{class:"mt-5"},{default:o(()=>{var V,$,s,O,a,_,g,S,h,E,C,D,A;return[e(f,{label:c.$t("recurring_invoices.starts_at"),"content-loading":i(r),value:(V=i(n).newRecurringInvoice)==null?void 0:V.formatted_starts_at},null,8,["label","content-loading","value"]),e(f,{label:c.$t("recurring_invoices.next_invoice_date"),"content-loading":i(r),value:($=i(n).newRecurringInvoice)==null?void 0:$.formatted_next_invoice_at},null,8,["label","content-loading","value"]),(s=i(n).newRecurringInvoice)!=null&&s.limit_date&&((O=i(n).newRecurringInvoice)==null?void 0:O.limit_by)!=="NONE"?(d(),b(f,{key:0,label:c.$t("recurring_invoices.limit_date"),"content-loading":i(r),value:(a=i(n).newRecurringInvoice)==null?void 0:a.limit_date},null,8,["label","content-loading","value"])):w("",!0),(_=i(n).newRecurringInvoice)!=null&&_.limit_date&&((g=i(n).newRecurringInvoice)==null?void 0:g.limit_by)!=="NONE"?(d(),b(f,{key:1,label:c.$t("recurring_invoices.limit_by"),"content-loading":i(r),value:(S=i(n).newRecurringInvoice)==null?void 0:S.limit_by},null,8,["label","content-loading","value"])):w("",!0),(h=i(n).newRecurringInvoice)!=null&&h.limit_count?(d(),b(f,{key:2,label:c.$t("recurring_invoices.limit_count"),value:(E=i(n).newRecurringInvoice)==null?void 0:E.limit_count,"content-loading":i(r)},null,8,["label","value","content-loading"])):w("",!0),(C=i(n).newRecurringInvoice)!=null&&C.selectedFrequency?(d(),b(f,{key:3,label:c.$t("recurring_invoices.frequency.title"),value:(A=(D=i(n).newRecurringInvoice)==null?void 0:D.selectedFrequency)==null?void 0:A.label,"content-loading":i(r)},null,8,["label","value","content-loading"])):w("",!0)]}),_:1}),e(t,{class:"mt-8"},{default:o(()=>[L(I(c.$t("invoices.title",2)),1)]),_:1}),e(xe)]),_:1})}}},Te={__name:"View",setup(H){re();const n=U(),p=G();P(),q();const r=N(()=>{var v,c;return n.newRecurringInvoice?(c=(v=n.newRecurringInvoice)==null?void 0:v.customer)==null?void 0:c.name:""});function m(){return p.hasAbilities([T.DELETE_RECURRING_INVOICE,T.EDIT_RECURRING_INVOICE])}return(v,c)=>{const R=l("BasePageHeader"),t=l("BasePage");return d(),b(t,{class:"xl:pl-96"},{default:o(()=>[e(R,{title:r.value},{actions:o(()=>[m()?(d(),b(ce,{key:0,row:i(n).newRecurringInvoice},null,8,["row"])):w("",!0)]),_:1},8,["title"]),e(Be),e(we)]),_:1})}}};export{Te as default};
